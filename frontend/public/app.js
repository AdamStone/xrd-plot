angular.module("DataAnalysis",["MainController","D3Service","FileInputDirectives","GraphDirective"]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]);var HSVtoRGB=function(a,b,c){var d,e,f,g,h,i,j,k;switch(a&&void 0===b&&void 0===c&&(b=a.s,c=a.v,a=a.h),g=Math.floor(6*a),h=6*a-g,i=c*(1-b),j=c*(1-h*b),k=c*(1-(1-h)*b),g%6){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;case 5:d=c,e=i,f=j}return{r:Math.floor(255*d),g:Math.floor(255*e),b:Math.floor(255*f)}},generateColors=function(a){for(var b=.618033988749895,c=Math.random(),d=["#000"],e=0;a>e;e++){c+=b,c%=1;var f=HSVtoRGB(c,.85,.6);d.push("rgb("+f.r+","+f.g+","+f.b+")")}return d};angular.module("FileInputDirectives",[]).directive("pdfInput",[function(){return{restrict:"E",templateUrl:"pdfInputTemplate.html",replace:!0,scope:{files:"=",scale:"="},link:function(a,b){var c=angular.element(b).find('[name="pdf-input"]');a.addFiles=function(){c.click()},a.clearFiles=function(){c.wrap("<form>").closest("form").get(0).reset(),c.unwrap(),a.files={}},a.pickColor=function(a){var c=angular.element(b).find('[name="color-input-'+a+'"]');console.log(c),c.click()},c.bind("change",function(b){console.log("change triggered");var c=b.target.files;a.readers=[];for(var d=0;d<c.length;d++)a.readers.push(new FileReader),a.readers[d].onload=function(b){var b=b;return function(c){for(var d=c.target.result.split(/[\r\n]+/g),e=[],f=0;f<d.length;f++)if(d[f].length>1){var g=d[f].split(/[ \t,]+/g);if(/[a-zA-Z]+/.test(g[0]));else{var h=parseFloat(g[0]),i=parseFloat(g[1]);if(!isNaN(h)&&!isNaN(i)&&g[0]<90){var j=(100*h-100*h%5)/100,k=j+.05;e.push({x:j,y:0}),e.push({x:h,y:i}),e.push({x:k,y:0})}}}e.push({x:90,y:0}),e.unshift({x:10,y:0}),a.$apply(function(){a.files[b]={filename:b,points:e,color:generateColors(1)[1]}})}}(c[d].name),a.readers[d].readAsText(c[d])})}}}]).directive("xyInput",[function(){return{restrict:"E",templateUrl:"xyInputTemplate.html",replace:!0,scope:{files:"="},link:function(a,b){var c=angular.element(b).find('[name="spectra-input"]');a.addFiles=function(){c.click()},a.clearFiles=function(){c.wrap("<form>").closest("form").get(0).reset(),c.unwrap(),a.files={}},a.pickColor=function(a){var c=angular.element(b).find('[name="color-input-'+a+'"]');console.log(c),c.click()},c.bind("change",function(b){var c=b.target.files;a.readers=[];for(var d=0;d<c.length;d++)a.readers.push(new FileReader),a.readers[d].onload=function(b){var b=b;return function(c){for(var d=c.target.result.split(/[\r\n]+/g),e=[],f=0;f<d.length;f++)if(d[f].length>1){var g=d[f].split(/[ \t,]+/g);if(2==g.length){var h=parseFloat(g[0]),i=parseFloat(g[1]);isNaN(h)||isNaN(i)||(e[f]={x:h,y:i})}}a.$apply(function(){a.files[b]={filename:b,points:e,color:generateColors(1)[1]}})}}(c[d].name),a.readers[d].readAsText(c[d])})}}}]),angular.module("GraphDirective",[]).directive("vectorGraph",["D3",function(a){return{restrict:"E",replace:!1,templateUrl:"graphTemplate.html",scope:{spectra:"=",pdfs:"=",graph:"=config"},link:function(b,c){b.margin=30;var d=angular.element(c).find("svg")[0];b.width=d.clientWidth,b.height=d.clientHeight,b.getSVGb64=function(){var a=angular.element(c).find("svg").clone().wrap("<div/>").parent().html();return btoa(decodeURIComponent(encodeURIComponent(a)))},b.axisStyle=function(){return{"shape-rendering":"crispEdges",stroke:"#000","stroke-width":"1px",fill:"none"}},b.spectrumStyle=function(a){return{stroke:a,"stroke-width":"0.5px",fill:"none"}},b.pdfStyle=function(a){return{stroke:a,"stroke-width":"1px",fill:"none"}},window.onresize=function(){b.$apply(function(){b.width=d.clientWidth,b.height=d.clientHeight})},b.paths={},b.getPath=function(d,e){var f=JSON.stringify(d);e||(e=1);var g=b.paths[f];return f in b.paths&&g.height===b.height&&g.width===b.width&&g.scale===b.graph.pdfScale||(b.paths[f]={path:a.buildPath(d,b.width-2*b.margin,(b.height-2*b.margin)*e)(d),width:b.width,height:b.height,scale:b.graph.pdfScale}),a.buildAxes(d,b.width-2*b.margin,b.height-2*b.margin,angular.element(c).find(".axis-group")),b.paths[f].path}}}}]);var HSVtoRGB=function(a,b,c){var d,e,f,g,h,i,j,k;switch(a&&void 0===b&&void 0===c&&(b=a.s,c=a.v,a=a.h),g=Math.floor(6*a),h=6*a-g,i=c*(1-b),j=c*(1-h*b),k=c*(1-(1-h)*b),g%6){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;case 5:d=c,e=i,f=j}return{r:Math.floor(255*d),g:Math.floor(255*e),b:Math.floor(255*f)}},generateColors=function(a){for(var b=.618033988749895,c=Math.random(),d=["#000"],e=0;a>e;e++){c+=b,c%=1;var f=HSVtoRGB(c,.85,.6);d.push("rgb("+f.r+","+f.g+","+f.b+")")}return d};angular.module("MainController",[]).controller("Main",["$scope",function(a){a.spectra={},a.pdfs={},a.colors=generateColors(20),a.graph={pdfScale:50,getStyle:function(b){return{fill:"none",stroke:a.colors[b],"stroke-width":.5}}}}]),angular.module("D3Service",[]).factory("D3",[function(){var a=function(a,b,c){var d=d3.scale.linear().range([0,b]).domain(d3.extent(a,function(a){return a.x})),e=d3.scale.linear().range([c,0]).domain(d3.extent(a,function(a){return a.y}));return[d,e]};return{buildPath:function(b,c,d){var e=a(b,c,d),f=e[0],g=e[1];return d3.svg.line().x(function(a){return f(a.x)}).y(function(a){return g(a.y)})},buildAxes:function(b,c,d,e){var f=a(b,c,d),g=f[0],h=(f[1],d3.svg.axis().scale(g).orient("bottom"));h(e);var i=e.find("text");i.attr("dy","10px")}}}]);